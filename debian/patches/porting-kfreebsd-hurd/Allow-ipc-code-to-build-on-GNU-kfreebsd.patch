From: Mike Hommey <mh@glandium.org>
Date: Thu, 30 Jun 2011 18:29:22 +0200
Subject: Allow ipc code to build on GNU/kfreebsd

---
 mozilla/ipc/chromium/src/base/platform_thread_posix.cc | 6 +++++-
 mozilla/ipc/chromium/src/build/build_config.h          | 2 +-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/mozilla/ipc/chromium/src/base/platform_thread_posix.cc b/mozilla/ipc/chromium/src/base/platform_thread_posix.cc
index be25069..98ec20f 100644
--- a/mozilla/ipc/chromium/src/base/platform_thread_posix.cc
+++ b/mozilla/ipc/chromium/src/base/platform_thread_posix.cc
@@ -49,7 +49,11 @@ PlatformThreadId PlatformThread::CurrentId() {
 #ifdef MOZ_WIDGET_GONK
   return (intptr_t) (pthread_self());
 #else
-  return syscall(__NR_gettid);
+#ifdef __NR_gettid
+   return syscall(__NR_gettid);
+#else
+   return getpid();
+#endif
 #endif
 #elif defined(OS_OPENBSD) || defined(__GLIBC__)
   return (intptr_t) (pthread_self());
diff --git a/mozilla/ipc/chromium/src/build/build_config.h b/mozilla/ipc/chromium/src/build/build_config.h
index dcec00d..3385341 100644
--- a/mozilla/ipc/chromium/src/build/build_config.h
+++ b/mozilla/ipc/chromium/src/build/build_config.h
@@ -20,7 +20,7 @@
 #define OS_LINUX 1
 #elif defined(__APPLE__)
 #define OS_MACOSX 1
-#elif defined(__linux__)
+#elif defined(__linux__) || defined(__GLIBC__)
 #define OS_LINUX 1
 #elif defined(__DragonFly__)
 #define OS_DRAGONFLY 1
